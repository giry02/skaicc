Subject: [긴급 요청] 멀티모달 콜봇 고도화를 위한 솔루션 연동 규격 추가 (VAD, Sync, Barge-in)

안녕하세요, ACP 솔루션 담당자님.
SK브로드밴드 AICC 멀티모달 프로젝트 개발팀입니다.

성공적인 멀티모달(보이는 음성 상담) 구현을 위해서는 단순한 텍스트 교환을 넘어, **음성(Voice)과 화면(Screen)의 정교한 동기화**가 필수적입니다.
이에 따라 기존 요청사항(VAD)에 더해, 아래 항목들에 대한 **기술 지원 및 인터페이스 명세**를 강력히 요청드립니다.

---

### [핵심 요청 사항: Voice-Screen Interaction Specs]

**1. VAD(Voice Activity Detection) 이벤트 (기존 요청 재강조)**
*   `SPEECH_START` / `SPEECH_END`: 고객 발화 구간 실시간 감지 트리거 필수.
*   `AUDIO_LEVEL`: 파동(Wave) 효과 구현을 위한 실시간 데시벨 데이터 스트림.
*   **[New] Barge-in Duration**: 고객이 침묵(Listening) 상태에서 몇 초 만에 끼어들었는지 `offset_ms` 전달. (시나리오 최적화용)

**2. 실시간 STT 중간 결과 (Intermediate Results) - *중요***
*   **현상**: 고객이 긴 문장을 말할 때, 발화가 완전히 끝날 때까지 화면이 멈춰있음.
*   **요청**: 발화 중인 텍스트 스트림(`partial_transcript`)을 실시간으로 내려주십시오.
    *   *예: "요금..." -> "요금 납부..." -> "요금 납부 하고 싶어" (화면에 실시간 자막 노출용)*

**3. 화면 제어 동기화 (TTS-Screen Sync)**
*   **현상**: AI가 "화면의 붉은 버튼을 누르세요"라고 말하는데, 실제 버튼은 1~2초 뒤에 뜸. (타이밍 불일치)
*   **요청**: TTS 오디오 스트림 내에 **메타데이터(특정 시점 마커)**를 포함하거나, **화면 전환 커맨드 패킷**을 오디오보다 *먼저* 전송하여 클라이언트가 싱크를 맞출 수 있게 해주십시오.

**4. Barge-in (말 끊기) 시그널 처리**
*   **시나리오**: AI가 설명 중인데 고객이 "알았어, 다음"이라고 말을 끊음.
*   **요청**: `BARGE_IN_DETECTED` 이벤트를 즉시 전송하여, 클라이언트가 **재생 중인 TTS 오디오와 화면 애니메이션을 즉각 중단**할 수 있도록 해야 합니다.

**5. Intent & Confidence Score (의도 및 신뢰도)**
*   **요청**: STT 완료 시 단순 텍스트뿐만 아니라, 분석된 **의도(Intent Code)**와 **신뢰도(Score)**를 함께 주십시오.
    *   *활용: 신뢰도가 낮을 경우 "잘 못 들었어요" 화면으로 분기 처리.*

---

### [추가 제안: 양방향 인터랙션 (Bidirectional Interaction)]

**6. 역방향 이벤트 (Touch-to-Voice) : `sendEventToBot()`**
*   **시나리오**: 고객이 화면의 버튼(Button)을 클릭했을 때, 이를 봇이 인지하고 "네, 알겠습니다"라고 음성 반응을 해야 함.
*   **요청**: 클라이언트(Web)에서 Bot Context로 이벤트를 쏘는 **JavaScript SDK 함수**가 필요합니다.
    *   `BotSDK.sendEvent("BUTTON_CLICKED", { id: "pay_now" })`

**7. 네트워크 상태 알림 (Network Context)**
*   **시나리오**: 고객이 이동 중이라 LTE 신호가 약함(Weak Signal). 무거운 영상이나 그래프 로딩 시 멈춤 현상 발생.
*   **요청**: `NETWORK_QUALITY: LOW/MID/HIGH` 이벤트를 주시면, **저사양 모드(Lite Mode)**로 UI를 자동 전환하겠습니다.

**8. 보안 키패드 연동 (Secure Input)**
*   **시나리오**: 카드 번호 입력 시, 화면에 보안 키패드가 뜨고, 입력된 값은 **STT 엔진을 거치지 않고** 결제 모듈로 직접 넘어가야 함. (PCI-DSS 준수)
*   **요청**: `SECURE_INPUT_MODE` 커맨드 수신 시, 마이크를 끄고 보안 키패드 활성화 로직 지원 여부.

**9. 세션 유지 및 복구 (Session Restore)**
*   **시나리오**: 고객이 실수로 브라우저를 닫았다가 다시 열었을 때.
*   **요청**: `SESSION_ID` 기반으로 **마지막 상태(Last State)를 복구**하여 대화를 이어서 진행할 수 있는가?

**10. [Critical] 통화 종료 감지 및 생명주기 (Call Lifecycle Integration)**
*   **아키텍처 인지**: 귀사 솔루션이 브로드밴드 인프라 내부(On-premise/Private Cloud)에서 동작하며, `CALLID`를 받아 구동되는 구조임을 알고 있습니다.
*   **핵심 질문**: 상위 교환기(PBX/SBC)에서 통화가 종료되었을 때, 솔루션은 어떤 방식으로 그 신호를 감지합니까?
    *   **Case A (SIP 연동 시)**: SIP `BYE` 패킷 수신 시 즉시 웹소켓으로 `CALL_ENDED` 전파 가능한가?
    *   **Case B (API 연동 시)**: 브로드밴드 Core 시스템으로부터 `OnCallEnd(CallID)` 콜백을 받는 인터페이스가 있는가?
    *   **Case C (Heartbeat)**: 주기적으로 `CallID`의 활성 상태(Alive Check)를 수행하는가?
*   **요구사항**: 어떤 방식을 쓰든, **웹 클라이언트(User Browser)에는 1초 이내에 종료 시그널**이 도달해야 합니다. (Polling 방식 제외)

---

### [연동 방식 제안]
위 모든 데이터는 웹 클라이언트에서 지연 없이 처리하기 위해 **WebSocket** 방식으로 통합 전송되기를 희망합니다.

관련 API 명세서(Interface Control Document)가 있다면 공유 부탁드리며,
없다면 본 요청사항을 기반으로 협의를 진행하고 싶습니다.

빠른 회신 기다리겠습니다.
감사합니다.

멀티모달 개발팀 드림.
